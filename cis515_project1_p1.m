clear all
clc
figure(1)
clf
axis([0 100 0 100])
dx=[];
dy=[];
while 1
   [nx,ny,butt]=ginput(1); % Create an (xh,y) pair using the mouse input.
    dx=[dx;nx]; % Add the new x to the history of all x.
    dy=[dy;ny]; % "   "   "   y   "   "   "   "   "   y.
    d=[dx dy]; % Create a 2xN matrix with the whole history of (x,y) pairs.
    disp([nx ny]) % <-- Print (x,y) history to console.
    hold off
    plot(d(:,1),d(:,2),'ok') 
    axis([0 100 0 100])
    hold on
    N=length(dx);

    switch (N)
      case {0,1,2,3,4,5,6}
        disp('MOAR DOTS')
      otherwise,
        b0(1,:) = d(0+1,:);
        b1(1,:) = d(1+1,:);
        b2(1,:) = (1/2)*d(1+1,:)+(1/2)*d(2+1,:);
        b3(1,:) = (1/4)*d(1+1,:)+(7/12)*d(2+1,:)+(1/6)*d(3+1,:);
        
        b0(2,:) = (1/4)*d(1+1,:)+(7/12)*d(2+1,:)+(1/6)*d(3+1,:);
        b1(2,:) = (2/3)*d(2+1,:)+(1/3)*d(3+1,:);
        b2(2,:) = (1/3)*d(2+1,:)+(2/3)*d(3+1,:);
        b3(2,:) = (1/6)*d(2+1,:)+(4/6)*d(3+1,:)+(1/6)*d(4+1,:);
        
        b0(3:N-5,:) = (1/6)*d(2+1:N-5,:)+(4/6)*d(3+1:N-4,:)+(1/6)*d(4+1:N-3,:);
        b1(3:N-5,:) = (2/3)*d(3+1:N-4,:)+(1/3)*d(4+1:N-3,:);
        b2(3:N-5,:) = (1/3)*d(3+1:N-4,:)+(2/3)*d(4+1:N-3,:);
        b3(3:N-5,:) = (1/6)*d(3+1:N-4,:)+(4/6)*d(4+1:N-3,:)+(1/6)*d(5+1:N-2,:);
        
        b0(N-4,:) = (1/6)*d(N-4,:)+(4/6)*d(N-3,:)+(1/6)*d(N-2,:);
        b1(N-4,:) = (2/3)*d(N-3,:)+(1/3)*d(N-2,:);
        b2(N-4,:) = (1/3)*d(N-3,:)+(2/3)*d(N-2,:);
        b3(N-4,:) = (1/6)*d(N-3,:)+(7/12)*d(N-2,:)+(1/4)*d(N-1,:);
        
        b0(N-3,:) = (1/6)*d(N-3,:)+(7/12)*d(N-2,:)+(1/4)*d(N-1,:);
        b1(N-3,:) = (1/2)*d(N-2,:)+(1/2)*d(N-1,:);
        b2(N-3,:) = d(N-1,:);
        b3(N-3,:) = d(N,:);
        
        plot(b0(:,1),b0(:,2),'b.')
        plot(b1(:,1),b1(:,2),'r.')
        plot(b2(:,1),b2(:,2),'r.')
        plot(b3(:,1),b3(:,2),'bo')

        clear b10 b11 b12 b20 b21 b30
        for t=0:.01:1
            b10(:,1) = b0(:,1)*(1-t) + b1(:,1)*t;
            b10(:,2) = b0(:,2)*(1-t) + b1(:,2)*t;
            b11(:,1) = b1(:,1)*(1-t) + b2(:,1)*t;
            b11(:,2) = b1(:,2)*(1-t) + b2(:,2)*t;
            b12(:,1) = b2(:,1)*(1-t) + b3(:,1)*t;
            b12(:,2) = b2(:,2)*(1-t) + b3(:,2)*t;
            
            b20(:,1) = b10(:,1)*(1-t) + b11(:,1)*t;
            b20(:,2) = b10(:,2)*(1-t) + b11(:,2)*t;
            b21(:,1) = b11(:,1)*(1-t) + b12(:,1)*t;
            b21(:,2) = b11(:,2)*(1-t) + b12(:,2)*t;
            
            b30(:,1) = b20(:,1)*(1-t) + b21(:,1)*t;
            b30(:,2) = b20(:,2)*(1-t) + b21(:,2)*t;
            plot(b30(:,1),b30(:,2),'.g')
        end

    end

end